<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Th·ª±c hi·ªán y l·ªánh thu·ªëc</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        td.ten-thuoc {
            white-space: normal !important;
            word-wrap: break-word;
        }
    </style>
</head>

<body class="bg-light">

    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand">Y l·ªánh thu·ªëc</span>
            <div class="d-flex ms-auto text-white">
                <span class="me-3">üë©‚Äç‚öïÔ∏è ƒêi·ªÅu d∆∞·ª°ng: <strong>Nguy·ªÖn Th·ªã A</strong></span>
            </div>
        </div>
    </nav>

    <!-- N·ªôi dung -->
    <div class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>üë§ B·ªánh nh√¢n: <span class="text-primary">Tr·∫ßn VƒÉn B</span></h4>
            <button class="btn btn-success" id="btnSign">K√Ω ‚úî</button>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover bg-white shadow-sm align-middle">
                <thead class="table-secondary">
                    <tr>
                        <th scope="col" style="width: 50px;">‚úî</th>
                        <th scope="col">T√™n thu·ªëc / Ghi ch√∫</th>
                        <th scope="col" style="width: 150px;">Gi·ªù</th>
                        <th scope="col" style="width: 150px;">S·ªë l∆∞·ª£ng</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center"><input type="checkbox"></td>
                        <td class="ten-thuoc">
                            Paracetamol 500mg <br>
                            <small class="text-muted">Ghi ch√∫: u·ªëng sau ƒÉn</small>
                        </td>
                        <td><input type="time" class="form-control form-control-sm"></td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" class="form-control" min="1" max="99" maxlength="2"
                                    style="max-width:70px;">
                                <span class="input-group-text">vi√™n</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center"><input type="checkbox"></td>
                        <td class="ten-thuoc">
                            Amoxicillin 500mg <br>
                            <small class="text-muted">Ghi ch√∫: tr√°nh d√πng chung v·ªõi s·ªØa</small>
                        </td>
                        <td><input type="time" class="form-control form-control-sm"></td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" class="form-control" min="1" max="99" maxlength="2"
                                    style="max-width:70px;">
                                <span class="input-group-text">vi√™n</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
    <!-- Script demo -->
    <script>
        const nurse = "{{ nurseName }}";
        const patient = "{{ patientName }}";

        document.querySelectorAll("input[type=number]").forEach(inp => {
            inp.addEventListener("input", function () {
                if (this.value.length > 2) this.value = this.value.slice(0, 2);
            });
        });

        document.getElementById("btnSign").addEventListener("click", async function () {
            const checkedRows = document.querySelectorAll("tbody tr");
            let signedData = [];

            checkedRows.forEach(row => {
                const checkbox = row.querySelector("input[type=checkbox]");
                if (checkbox.checked) {
                    const drugName = row.querySelector(".ten-thuoc").innerText.trim();
                    const time = row.querySelector("input[type=time]").value;
                    const qty = row.querySelector("input[type=number]").value;

                    signedData.push({
                        drug: drugName,
                        time: time,
                        quantity: qty
                    });
                }
            });

            if (signedData.length === 0) {
                alert("B·∫°n ch∆∞a ch·ªçn thu·ªëc n√†o ƒë·ªÉ k√Ω!");
                return;
            }

            try {
                let response = await fetch("https://your-server/api/sign", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nurse: nurse,
                        patient: patient,
                        drugs: signedData
                    })
                });

                if (response.ok) {
                    alert("ƒê√£ k√Ω th√†nh c√¥ng!");
                } else {
                    alert("K√Ω th·∫•t b·∫°i, l·ªói server!");
                }
            } catch (error) {
                console.error(error);
                alert("Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server!");
            }
        });
    </script>

</body>

</html>